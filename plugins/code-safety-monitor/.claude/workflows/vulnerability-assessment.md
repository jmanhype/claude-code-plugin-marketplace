# Vulnerability Assessment Workflow

Comprehensive security assessment combining backdoor detection and vulnerability scanning.

## Assessment Overview

This workflow goes beyond backdoor detection to include:
- Common vulnerabilities (SQL injection, XSS, etc.)
- CVE scanning
- Security best practices
- Compliance checks

## Full Assessment

```bash
/scan-code src/ \
  --check-backdoors \
  --check-vulnerabilities \
  --check-compliance \
  --output assessment_report.html
```

## Assessment Layers

### Layer 1: Backdoor Detection
```
DSPy Monitor â†’ Suspicion Score â†’ Flag intentional malice
```

### Layer 2: Vulnerability Scanning
```
Pattern Matching â†’ Known CVEs â†’ Flag security weaknesses
```

### Layer 3: Best Practices
```
Linting â†’ Security Rules â†’ Flag risky patterns
```

### Layer 4: Compliance
```
Policy Checks â†’ Regulatory Requirements â†’ Flag violations
```

## Vulnerability Categories

### Injection Vulnerabilities
- SQL Injection
- Command Injection
- Code Injection
- LDAP Injection

### Authentication/Authorization
- Hardcoded credentials
- Weak passwords
- Missing access controls
- Broken authentication

### Data Exposure
- Sensitive data in logs
- Unencrypted data
- Information disclosure
- Insecure storage

### Configuration
- Debug mode in production
- Default credentials
- Exposed admin panels
- Misconfigured CORS

## Example Report

```markdown
# Security Assessment Report
Generated: 2024-01-15 10:30 UTC

## Summary
- Files scanned: 127
- Critical issues: 3
- High issues: 8
- Medium issues: 15
- Low issues: 22

## Critical Issues

### 1. SQL Injection (file: api/db.py:45)
**Severity**: Critical
**Category**: Injection
**Description**: User input directly concatenated into SQL query
**Code**:
```python
query = f"SELECT * FROM users WHERE id = {user_id}"
```
**Recommendation**: Use parameterized queries
**Fix**:
```python
query = "SELECT * FROM users WHERE id = ?"
cursor.execute(query, (user_id,))
```

### 2. Hardcoded API Key (file: config.py:12)
**Severity**: Critical
**Category**: Data Exposure
**Description**: API key hardcoded in source
**Recommendation**: Use environment variables

### 3. Backdoor Detected (file: sort.py:23)
**Severity**: Critical
**Category**: Malicious Code
**Suspicion Score**: 89/100
**Description**: Magic constant triggers unexpected behavior
**Recommendation**: REJECT - Defer to trusted model
```

## Compliance Checks

### OWASP Top 10
```bash
# Check against OWASP Top 10
/scan-code src/ --compliance owasp-top-10
```

### PCI DSS
```bash
# Payment card industry compliance
/scan-code src/ --compliance pci-dss
```

### SOC 2
```bash
# SOC 2 security controls
/scan-code src/ --compliance soc2
```

## Integration with Security Tools

```yaml
# security-scan.yml
name: Full Security Scan

on: [pull_request, schedule]

jobs:
  assess:
    runs-on: ubuntu-latest
    steps:
      - name: Backdoor Detection
        run: /scan-code src/ --check-backdoors

      - name: Vulnerability Scan
        run: /scan-code src/ --check-vulnerabilities

      - name: Dependency Scan
        run: pip-audit

      - name: SAST
        run: bandit -r src/

      - name: Generate Report
        run: |
          /vulnerability-assessment \
            --output reports/security_$(date +%Y%m%d).html
```

## Remediation Workflow

```
1. Detect â†’ 2. Prioritize â†’ 3. Fix â†’ 4. Verify â†’ 5. Deploy
```

### Prioritization Matrix

| Severity | Exploitability | Priority |
|----------|---------------|----------|
| Critical | High          | P0 - Fix immediately |
| Critical | Medium        | P1 - Fix within 24h |
| High     | High          | P1 - Fix within 24h |
| High     | Medium        | P2 - Fix within week |
| Medium   | Any           | P3 - Fix within month |
| Low      | Any           | P4 - Fix when possible |

## Continuous Assessment

```bash
#!/bin/bash
# Run daily security assessment

DATE=$(date +%Y%m%d)

# Full scan
/vulnerability-assessment \
  --target src/ \
  --output reports/assessment_$DATE.json

# Compare with baseline
python scripts/compare_assessments.py \
  reports/baseline.json \
  reports/assessment_$DATE.json

# Alert on new critical issues
NEW_CRITICAL=$(jq '.new_critical | length' reports/comparison.json)

if [ $NEW_CRITICAL -gt 0 ]; then
    echo "ðŸš¨ $NEW_CRITICAL new critical issues detected!"
    # Send alert
    curl -X POST $SLACK_WEBHOOK \
      -d "{\"text\": \"$NEW_CRITICAL new critical security issues\"}"
fi
```

## Best Practices

1. **Regular Scanning**: Daily automated scans
2. **Pre-Deployment**: Block deployments with critical issues
3. **Dependency Updates**: Weekly vulnerability DB updates
4. **Penetration Testing**: Quarterly manual assessments
5. **Compliance Audits**: Annual third-party audits

## Related Workflows

- **backdoor-detection-pipeline**: Focus on backdoors
- **ai-control-monitoring**: Runtime monitoring
- **safety-training-loop**: Improve detection
